<!--
SCHEDULE DETAIL VIEW 
::view::sch.views2.schDetailView

-->

{% extends 'base.html' %}
{% load slippers %} {% load django_tables2 %} {% load tags %}
{% load cache %}

{% block style %}
    <style>
        body {
            background-image: url('/static/img/Geode_seamlessOlive.png');
            background-repeat: repeat;
            background-size: 30%;
        }
        .loading-dimmer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.2);
            z-index: 100;
            display: none;
        }
    </style>
{% endblock style %}
    

{% block content %}




    <a href="{% url 'sch:sch-list' %}"><i class="fas">{% backArrow %}</i> Back to List</a>
    
    <div class="panel text text-center">
        <h1 class="text-3xl text-zinc-400 text-bold">

                {{schedule.year}}-Schedule {{schedule.number}}
                    
        </h1> 
        <h3 class="text-lg text-zinc-100 text-light">
        
                    VERSION {{schedule.version}}   
        </h3>

        <div class="text-xs text-zinc-300 italic">

        <span>
            {{ schedule.slots.filled.count }} 
            / {{ schedule.slots.all.count }} 
            SLOTS ASSIGNED 
        </span>
        {% if schedule.percent < 70 %} 
        <div><i class="text-3xl text-orange-400 fa-duotone fa-dumpster-fire"></i> </div>
        {% endif %}
        

    </div>

    {# --- STATS BAR ---#}
    <section id="stat-bar">

            {% include 'sch2/schedule/detail/stat-bar.html' %}

    </section>
   

    <hr class="bg-slate-300 mx-12 mb-4 mt-12"/>

    <div class="sm:w-9/12 lg:w-5/12 flex flex-row">

        <h2 id="compare-head" 
            class="jbm text-xl text-slate-900 bg-slate-300 rounded p-2 translate-x-2">

            <i class="text-sky-800 fa-duotone fa-code-compare"></i>
            COMPARE
        </h2>

        <select name="select-for-compare" 
                id="select-for-compare"
                class="bg-sky-100 
                    pl-2 
                    pr-7 
                    font-extralight 
                    text-sky-100 
                    hover:bg-sky-200"
                onchange="selectLoading(this)"
                >
                    <option value="" 
                        selected 
                        disabled>
                    Select schedule...</option>

                {% for sch in otherSchedules %}
                    <option value="{% url 'sch:compare-schedules' schedule.slug sch.slug %}"
                             class="text-xs 
                                    font-light">
                        {{ sch.year }}: Schedule {{ sch.number }} 
                        (Version {{ sch.version }})
                    </option>
                {% endfor %}
                
        </select>

    </div>

    <script>
        function selectLoading(select) {
                // get #compare-head and put a spinner in it 
                var compareHead = document.getElementById("compare-head");
                var spinner = document.createElement("i");
                spinner.classList.add("fas", "fa-spinner", "fa-spin", "text-lg", "fa-beat", "text-sky-800");
                compareHead.innerHTML = "";
                compareHead.appendChild(spinner);
                // get the selected option in #select-for-compare and redirect to it
                var selectedOption = select.options[select.selectedIndex];
                window.location.href = selectedOption.value;
        }
    </script>
    

    <hr class="bg-slate-300 mx-12 mb-4 mt-12"/>

    <div class="flex flex-row center center-content center-self gap-5 space-between"
         id="alt-view-linkbox">
        <a  href="{% url 'sch:v2-schedule-as-empl-grid' schedule.slug %}" 
            class="bg-slate-900 p-2 rounded ring hover:bg-amber-800 hover:ring-amber-100 text-2xs"
            onclick="loadingButton(this)">

            <i class="text-lg fa-duotone fa-poll-people"></i><br/>
            VIEW AS EMPLOYEE GRID </a>

        <a  href="{% url 'sch:v2-schedule-as-shift-grid' schedule.slug %}" 
            class="bg-slate-900 p-2 rounded ring hover:bg-amber-800 hover:ring-amber-100 text-2xs"
            onclick="loadingButton(this)">

            <i class="text-lg fa-duotone fa-grid-dividers"></i><br/>
            VIEW AS SHIFT GRID </a>

        <a  href="{% url 'sch:sch-fte-percents' schedule.slug %}"
            class="bg-slate-900 p-2 rounded ring hover:bg-amber-800 hover:ring-amber-100 text-2xs"
            onclick="loadingButton(this)">
            
            <i class="text-lg fa-duotone fa-chart-bullet"></i><br/>
            VIEW FTE-SCHEDULED RATIOS </a>

        <!-- Example single danger button -->
            <div class="btn-group">
                <button type="button" 
                        class="text-zinc-300 bg-zinc-900 hover:bg-zinc-700 px-3 py-1 jbm border border-sky-600 rounded " 
                        data-bs-toggle="dropdown" 
                        aria-expanded="false">
                    Actions
                    <i class="fa-duotone fa-chevron-down px-1"></i>
                </button>

                    <ul class="dropdown-menu">
                    <li><a class="dropdown-item hover:bg-indigo-200 font-bold" href="{{ schedule.url__solve_b }}">
                                                    <i class="fa-duotone fa-user-robot text-lg text-indigo-500"></i>
                                                        Solve: Method A
                                                    <span class="text-2xs font-thin text-indigo-700"> 
                                                        USING A.I. <br/> 
                                                        TRAINED ON PREVIOUS SCHEDULES
                                                    </span> 
                                                </a>
                                            </li>
                    <li><a class="dropdown-item hover:bg-indigo-200 font-bold" href="#"> <i class="fa-duotone fa-function text-lg text-indigo-500"></i>
                                                        Solve:  Method B 
                                                    <span class="text-2xs font-thin text-indigo-700">
                                                        USING <br/>
                                                        QUASI-ALGORYTHYM
                                                    </span>
                                                </a>
                                            </li>
                    <li><a disabled class="dropdown-item bg-slate-300 font-thin italic">
                                                    <i class="fa-duotone fa-clock text-lg text-slate-500"></i>
                                                        Solve:  Method C
                                                    <span class="text-2xs font-thin text-slate-400">USING <br/>
                                                         TIME-AWARE VARIANT (UNDER CONSTRUCTION)
                                                    </span>
                                                </a>
                                            </li>
                    <li><a class="dropdown-item hover:bg-sky-200 font-bold" href="{% url 'sch:sch-clear-over-fte' schedule.slug %}"
                           hx-confirm="Please Note: <br/> This Currently Ignores All PRN employees">
                                                    <i class="fa-duotone fa-inboxes text-sky-400 text-lg"></i>
                                                        Maintain
                                                    <span class="text-2xs  text-sky-700">
                                                        CLEAR OUT ASSIGNED<br/> 
                                                        SLOTS RESULTING IN OVERTIME
                                                    </span>
                                                </a>
                                            </li>
                    
                    <li><hr class="dropdown-divider"></li>
                    <li><div class="dropdown-item hover:bg-red-300 bg-opeacity-90 font-bold font-red-300" href="#"
                        _="on click fetch '{{schedule.url__clear}}' then log 'done' then go to the top of the body smoothly">
                                                    <i class="fa-duotone fa-eraser text-red-800"></i>
                                                        Clear Slots
                                                </div>
                                            </li>
                    </ul>
                </div>
            </div>
    
    <script>
        function loadingButton(button) {
            // reduce the opacity of the button
            button.style.opacity = 0.5;
            // create the spinner element
            var spinner = document.createElement("i");
            spinner.classList.add("fas", "fa-spinner", "fa-spin", "text-lg", "fa-beat");
            var buttonWidth = button.offsetWidth + 'px';
            // replace the button text with the spinner element
            button.innerHTML = "";
            button.appendChild(spinner);
            button.style.width = buttonWidth;
        }
    </script>
        
  

    <div class="flex basis-1 shrink text text-center">
        
        <div class="overflow-x-auto"> 
                {# ========= SCHEDULE TABLE ========= #}
                {% include 'sch2/schedule/complex-table.html' %}
        </div>
    </div>   

</div>
    <form method="POST">{% csrf_token %}
        <select name="view-pto-empl-select" id="view-pto-empl" 
                class="bg-amber-100 pl-3 pr-7 font-light text-slate-700" 
                onchange="location = this.value;">
            <option value="">
                View Employee Schedule PTO 
            </option>
        {% for employee in employees %}
            <option class="px-3 font-light text-slate-700"
                value="{% url 'sch:v2-schedule-empl-pto' schedule.pk employee.pk %}">
                {{ employee }}'s PTO Requests
            </option>
        {% endfor %}
        </select>
    </form>

    <form 
    method="POST" 
    action="{% url 'sch:sch-time-pref-fill' schedule.pk %}"> 

        {% csrf_token %}

        <input 
        type="submit" 
        value="Perform Time-Preference Aware Fill"/>

    </form>
</div>



    
{% endblock content %} 
    