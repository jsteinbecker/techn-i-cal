{% load tags %}
{% load wtags %}


<div id="{{ employee.pk }}" 
    class="employee employee-chip cursor-move snap-always
            relative w-24 h-14 
            backdrop-blur bg-white/20 border border-gray-200 rounded-lg
            {% if desig == 'PTO' %}   opacity-60   {% endif %}
            {% if desig == 'TDO' %}   opacity-80   {% endif %}
            {% getAllowedFills employee workday %}"
    draggable="true" 
    available="{% for s in employee.shifts_available.all %}{% if s != slot.shift %} {{ s }} {% endif %}{% endfor %}"
    data-trained="{% for s in employee.shifts_trained.all %} {{ s }} {% endfor %}"
    turnaround="{% if slot.is_preturnaround %} -1
                {% elif slot.is_postturnaround %} 1
                {% else %} 0 {% endif %}"
    week-hours="{% weekHours employee workday %}"
    period-hours="{% periodHours employee workday %}" 
    slotted-as="{{ slot.shift }}"
    is_pto_conflict="{% if slot.pto_conflicts.exists %}true{% else %}false{% endif %}"
    previous-slot="{% emplPrevSlot employee workday %}"
    next-slot="{% emplNextSlot employee workday %}"
    _="init if @week-hours > 40 add .bg-red-500 to .clock in me end
       init if @period-hours > 80 add .bg-red-500 to .clock in me end
       init if @week-hours == 40 add .bg-slate-900 .text-white to .clock in me end
       init if @period-hours == 80 add .bg-slate-900 .text-white to .clock in me end
       init if @turnaround != 0 add .bg-rose-700 .bg-opacity-30 end
       init if @is_pto_conflict == 'true' add .bg-red-400 .bg-opacity-30 end
       init if @previous-slot == `AM` remove .hidden from #{{employee.pk}}-ind-prev-am end
       init if @previous-slot == `PM` remove .hidden from #{{employee.pk}}-ind-prev-pm end
       init if @previous-slot == `XN` remove .hidden from #{{employee.pk}}-ind-prev-pm end
       init if @next-slot == `AM` remove .hidden from #{{employee.pk}}-ind-next-am end
       init if @next-slot == `PM` remove .hidden from #{{employee.pk}}-ind-next-pm end
       init if @next-slot == `XN` remove .hidden from #{{employee.pk}}-ind-next-pm end
       on dragstart if @slotted-as != `` remove .hidden from .trashbin end 
       on dragstart set $emp to @id then set $empCard to me then log $empCard end
       on dragstart set $allow to @available.split(' ') end
       on dragstart send hlAllowed to .slot end
       on dragstart add .dragging end
       on dragstart set $empCard to me end
       on dragend remove .ring-green-500 from .slot then remove .dragging from me end
       on dragend set $allow to `` end
       on dragend send hideHl to .slot end
       on dragend add .hidden to .trashbin end
       on dblclick go to url '/sch/employee/{{employee.pk}}/' end ">
    <span id="{{employee.pk}}-ind-prev-am"
        class="hidden bg-yellow-400 text-xs font-medium text-amber-800 text-center p-0.5 leading-none rounded-full 
               px-2 py-2 absolute -translate-y-1/2 -translate-x-1/2 right-auto top-0 left-0">
        <i id="Prev-AM-Arrow" 
            class="fa-duotone fa-arrow-circle-left text-black"></i>
    </span>
    <span id="{{employee.pk}}-ind-next-am"
        class="hidden bg-yellow-400 text-xs font-medium text-amber-800 text-center p-0.5 leading-none rounded-full 
               px-2 py-2 absolute -translate-y-1/2 translate-x-1/2 left-auto top-0 right-0">
        <i class="fa-duotone fa-arrow-circle-right text-black"></i>
    </span>
    <span class="bg-slate-200 clock text-2xs font-light scale-[0.9] text-zinc-800 text-center p-0.5 leading-none rounded-full 
               px-2 absolute translate-y-1/2 translate-x-1/2 bottom-0 right-1/2">
        <i class="fas fa-stopwatch text-zinc-500"></i>
        <br/>
        {% weekHours employee workday %}-{% periodHours employee workday %}
    </span>
    <span 
        class="text-3xl font-thin italic opacity-90 text-zinc-800 text-center p-0.5 leading-none rounded-full 
               px-2 absolute -translate-y-1/2 -translate-x-1/2 top-1/4 left-1/2 z-20 bg-transparent
               {% if desig == 'PTO' %} text-rose-500 p-1 rounded shadow {% endif %}
               {% if desig == 'TDO' %} text-yellow-600 p-1 rounded shadow {% endif %}">
        {{ desig }}
    </span>
    <span class="text-sm font-bold text-zinc-200 center text-center p-0.5
               px-2 absolute -translate-y-3/4 -translate-x-1/2 top-2/4 left-1/2 truncate">
        <img src="{{employee.image_url}}" alt="{{employee}}" draggable=false class="w-10 h-10 rounded-full mx-auto border-2 border-white shadow">
        {{ employee.slug }}
        
    </span>
    <span id="{{employee.pk}}-ind-prev-pm"
        class="hidden bg-blue-200 text-xs font-medium text-blue-800 text-center p-0.5 leading-none rounded-full 
               px-2 py-2 absolute translate-y-1/2 -translate-x-1/2 right-auto bottom-0 left-0">
        <i class="fa-duotone fa-arrow-circle-left text-black"></i>
    </span>
    <span id="{{employee.pk}}-ind-next-pm"
        class="hidden bg-blue-200 text-xs font-medium text-blue-800 text-center p-0.5 leading-none rounded-full 
               px-2 py-2 absolute translate-y-1/2 translate-x-1/2 left-auto bottom-0 right-0">
        <i class="fa-duotone fa-arrow-circle-right text-black"></i>
    </span>
</div>

