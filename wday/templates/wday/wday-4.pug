extends 'base.html'

block mymixins

    // HELPER MIXINS -----------------------------

    mixin nextWd(workday)
        if workday.sd_id != 41
            a(href=workday.nextWD().url())
                i.fas.fa-chevron-right.opacity-40.text-xs.px-2

    mixin prevWd(workday)
        if workday.sd_id != 0
            a(href=workday.prevWD().url())
                i.fas.fa-chevron-left.opacity-40.text-xs.px-2

    mixin day-breadcrumbs(workday)
        #breadcrumbs
            a(href=workday.schedule.url())
                | SCHD #{workday.schedule.slug} 
            i.fas.fa-chevron-right.opacity-40.text-xs.px-2
            a(href=workday.period.url()) 
                | PRD #{workday.period.number}
            i.fas.fa-chevron-right.opacity-40.text-xs.px-2
            a(href=workday.week.url())
                | WEEK #{workday.week.number}
            i.fas.fa-chevron-right.opacity-40.text-xs.px-2
            span#wdid(data-value=workday.n()) DAY #{workday.n}

    mixin time-icon(daytime)
        if daytime == 'AM'
            i.fa-sun.fas.fa-sun.opacity-10.px-2.text-3xl.-left-5.-top-2.relative
        if daytime == 'PM'
            i.fas.fa-moon.opacity-10.px-2.text-3xl.-left-5.-top-2.relative
        if daytime == 'XN'
            i.fas.fa-tombstone.opacity-10.px-2.text-3xl.-left-6.-top-2.relative

    mixin hiddenPtoList(wd)
        div#pto-list.hidden(
            data-employees=' '.join(list(wd.pto_list()))
            )

    mixin template-empl-btn(slot)
        if slot.template_employee != slot.employee
            i.fa-solid.fa-street-view.opacity-30(
                _="install TemplateEmployeeBtn", 
                class="hover:text-amber-400 hover:opacity-50",
                data-employee=slot.employee,
                data-shift=slot.shift.name,
                data-template=slot.template_employee
                )

    mixin empl-context-arrows(empl, workday)
        span.absolute.bottom-0.right-0.mr-2.mb-3.fa-2x
            i.prev-arrow.fa-solid.fa-play.text-white.opacity-10.rotate-180
            i.next-arrow.fa-solid.fa-play.text-white.opacity-10.px-1

    mixin swap-in-button(slot)
        .swap-in-btn.hidden.z-10.bg-emerald-400.pointer-cursor.border.float-right.rounded.px-2.fa-beat.truncate(
            _="install SwapButton"
            )
                i.fas.fa-arrow-down-to-bracket.text-emerald-700
                span.text-sm.text-emerald-900.jbm SWAP IN

    // MAIN MIXINS --------------------------------

    mixin Employee(empl, workday)
        div.employee.relative.bg-slate-700.rounded.p-3.border-white.border.h-24.w-32.m-1(
            draggable='true'
            data-employee-id=empl.slug
            data-available=' '.join(list(empl.shifts_available.values_list('name',flat=True)))
            data-week-hours= empl.details_on_day(workday.slug)['wk_hours']
            data-period-hours= empl.details_on_day(workday.slug)['pd_hours']
            data-day-hours= empl.details_on_day(workday.slug)['day_hours']
            data-prev-day= empl.check_prev_day(workday.slug)
            data-next-day= empl.check_next_day(workday.slug)
            data-in-daytime= empl.check_daytime(workday.slug)
            data-in-slot= empl.check_slot(workday.slug)
            _='install Employee')
                img(src=empl.image_url draggable="false").w-10.h-10.rounded-full.border.saturate-0
                span.font-thin.text-sm.truncate= empl.name.upper
                div.hours-display.truncate
                +empl-context-arrows(empl, workday)
                
    mixin Slot(slot)
        div.slot.h-42.w-52.bg-zinc-900.bg-opacity-50.bg-blur.rounded.border.p-3(
            data-shift= slot.shift.name
            data-template= slot.template_employee
            data-employee= slot.employee
            data-time-of-day= slot.shift.group
            data-hours= slot.shift.hours
            data-slug= slot.slug
            _= 'install Slot')
                div.flex.flex-row
                    a.slot-link(
                        href=slot.url()
                        _="init if my.parentNode.parentNode@data-employee == null remove @href"
                        )
                        span.shift-name.font-light.text-2xl.opacity-70= slot.shift.name
                        +time-icon(slot.shift.group)

                    if slot.template_employee != null 
                        +template-empl-btn(slot)

                    +swap-in-button(slot)

                if slot.employee != null
                    +Employee(slot.employee, slot.workday)

block style 
    style.
        .h1              {font-size: 32px; font-family: 'JetBrains Mono';}
        .h4              {font-size: 20px; border-radius: 6px; color: #000044!important; background-color: white; font-weight: bold; padding: 5px 2px 5px 2px;}
        #SlotGrid        {display: grid; grid-template-columns: repeat(5, 1fr); grid-gap: 1rem; overflow-x:scroll;}
        #ScrollingDeck   {display: flex; flex-direction: row; overflow-x: scroll; margin:12px;adding: 12px; box-shadow: 0 0 10px #ffffff55;background-color: #ffffff55;}
        .active          {background-color: #ccffdd55!important; drop-shadow: 0 0 10px #ccffdd55;}
        .dragged-over-prohibited {background-color: #ff003333!important; drop-shadow: 0 0 10px #ff003377;}
        .dragged-over    {background-color: #ccffcc33!important;}
        .swap-in-btn > i {font-size: 9px; color: #003311ff;}
        .hours-display   {font-size: 9px; font-family: 'JetBrains Mono'; opacity: 0.5; text-overflow: ellipsis;}
        .pto-flag::after {content: 'PTO'; font-size: 10px; font-family: 'JetBrains Mono'; opacity: 0.5; color: #ff0000; position: absolute; top: 0; right: 0;}
        .ot-flag::after  {content: 'OT';  font-size: 10px; font-family: 'JetBrains Mono'; opacity: 0.5; color: #ee6655; position: absolute; top: 0; right: 0;}
        .badge-top-right {position: absolute; top: 0; right: 0;}

block pre 
    script(type='text/coffeescript', src='/static/wday-pug.coffee') 
    script(type='text/coffeescript', src='/static/workday/employee.coffee')
    script(type='text/hyperscript',  src='/static/wday-pug._hs')


//------------------ CONTENT ------------------//

block content 

    script(src='/static/base-cxt-menu.coffee' type="text/coffeescript")
    script(type="text/coffeescript" src="/static/workday/employee.coffee")


    +day-breadcrumbs(workday)

    .flex.flex-row 
        +prevWd(workday)
        .text-center
            h1.h1= workday.date
            h4.h4= workday.weekday
        +nextWd(workday)

    #background(_="install Background")

        #SlotGrid
            for slot in slots
                +Slot(slot)

        #ScrollingDeck(_="install Deck")
            for empl in workday.on_deck.all
                +Employee(empl, workday)

    +hiddenPtoList(workday)
            